# staking-income-calculator
Basic Repo to Calculate Staking Income

Simple calculator that attempts to return total staking income in the provided tax year along with the USD-denominated amount.

## USD Prices
This code uses Coin Gecko's free public api [endpoint](https://docs.coingecko.com/v3.0.1/reference/coins-id-market-chart-range) to determine USD prices. The api returns the price of the token at 00:00 UTC time (beginning of day).
Note: The api call uses the free version, so there is only historical data for the last 365 days.


## Approaches:
- Preferred/Supported is through downloading a csv of txns or rewards. Since the csv contains rewards for the address, the inputs here are just `protocol`, `year`, and `reward-file` (path).
- Still in-progress/may not be supported is through rpc nodes. Inputs necessary are just `address`, `protocol`, and `year`.

## Supported Assets

### Solana
There are 2 approaches. Either query the blockchain rpc node (public) to fetch inflation rewards (rate-limited), or download a csv of the reward events from SolScan.
- SolScan csv:
  - Looks for only staking rewards and matches the unix timestamp to the closes from the prices data.
- JSON-RPC Node (incomplete; needs ability to go from epoch to timestamps):
  - Directly fetches the inflation rewards for the delegator for each epoch. Since the public node is rate-limited, this approach takes longer.

### Cosmos:
- Preferred approach is by downloading a list of txns from mintscan.io. The code will filter for `GetReward` events and only report on `uatom` amounts.
- Note: We assume the reward-file is generated by MintScan and using UTC timestamps.
- Mintscan csv includes the price at time of the claim, meaning we don't need to fetch daily prices separately.


- Usage:
```
python cmd.py --year 2024 --protocol solana --reward-file data\solana_delegator_rewards_2024.csv 

python cmd.py --year 2024 --protocol cosmos --reward-file data\cosmos_txns_2024.csv
```
